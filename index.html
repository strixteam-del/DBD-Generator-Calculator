<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dead by Daylight: Generator Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #10131a;
            background-image: linear-gradient(145deg, #1a202c 0%, #10131a 100%);
        }
        h1, h2, h3, button {
            font-family: 'Bebas Neue', cursive;
        }
        .dbd-red {
            color: #ef4444; /* Brighter red */
            text-shadow: 0 0 8px rgba(239, 68, 68, 0.4); /* Add a glow */
        }
        .dbd-input {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            transition: all 0.2s ease-in-out;
        }
        .dbd-input:focus {
            outline: none;
            border-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.5);
        }
        .dbd-input:disabled {
            background-color: #1a202c;
            opacity: 0.5;
            cursor: not-allowed;
        }
        .dbd-button {
            background-color: #c53030;
            color: #fff;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3), 0 2px 4px -1px rgba(0,0,0,0.16);
        }
        .dbd-button:hover {
            background-color: #ef4444;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.3), 0 4px 6px -2px rgba(239, 68, 68, 0.15);
        }
        .dbd-button:disabled {
            background-color: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .survivor-card {
            border-left: 4px solid #c53030;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .survivor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2), 0 4px 6px -2px rgba(0,0,0,0.1);
        }
        /* Animation for result display */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4 lg:p-8">

    <div class="w-full max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-5 gap-8">
        
        <!-- Main Calculator Column -->
        <div class="lg:col-span-3 bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-lg shadow-2xl p-6 md:p-8 space-y-6">
            <!-- Header -->
            <header class="text-center">
                <h1 class="text-5xl md:text-6xl tracking-wider">Generator <span class="dbd-red">Calculator</span></h1>
                <p class="text-gray-400 mt-2">Calculate generator repair times in Dead by Daylight</p>
            </header>

            <!-- Generator Settings -->
            <section class="text-center border-y border-gray-700 py-4">
                <label for="generator-charges" class="block text-xl tracking-wider text-gray-300 mb-2">Generator Total Charges</label>
                <input type="number" id="generator-charges" value="90" min="1" class="dbd-input w-1/2 md:w-1/4 p-2 rounded-md text-center text-lg">
            </section>

            <!-- Survivors Section -->
            <section>
                <div class="flex justify-between items-center border-b-2 border-gray-700 pb-2 mb-6">
                     <h2 class="text-3xl tracking-wider">Survivors</h2>
                </div>
                <div id="survivors-container" class="space-y-6">
                    <!-- Survivor cards are generated by JS -->
                </div>
            </section>

            <!-- Calculation and Result -->
            <section class="text-center pt-6">
                <button id="calculate" class="dbd-button w-full md:w-2/3 py-3 rounded-lg text-3xl tracking-widest">Calculate</button>
                <div id="result-container" class="mt-8 bg-gray-900/70 p-4 rounded-lg hidden">
                    <h3 class="text-2xl tracking-wider dbd-red">Total Completion Time</h3>
                    <p id="result" class="text-4xl font-bold text-white"></p>
                </div>
            </section>
        </div>

        <!-- Calculation Breakdown Column -->
        <div class="lg:col-span-2 bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-lg shadow-2xl p-6 md:p-8">
            <h2 class="text-4xl tracking-wider border-b-2 border-gray-700 pb-2 mb-6">Calculation <span class="dbd-red">Breakdown</span></h2>
            <div id="calculation-breakdown" class="space-y-4 text-gray-300">
                <p class="text-gray-500 text-center pt-8">Click "Calculate" to see the details.</p>
            </div>
        </div>

    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dbdData = {
                survivor: { baseSpeed: 1 },
                toolboxes: {
                    none: { name: "No Toolbox", charges: 0, speedModifier: 1.0 },
                    worn_out: { name: "Worn-Out Tools", charges: 16, speedModifier: 1.5 },
                    toolbox: { name: "Toolbox", charges: 20, speedModifier: 1.5 },
                    mechanics: { name: "Mechanic's Toolbox", charges: 16, speedModifier: 1.75 },
                    commodious: { name: "Commodious Toolbox", charges: 32, speedModifier: 1.5 },
                    engineers: { name: "Engineer's Toolbox", charges: 16, speedModifier: 2.0 },
                    alexs: { name: "Alex's Toolbox", charges: 24, speedModifier: 1.1 },
                },
                addons: {
                    none: { name: "No Add-on", charges: 0, speedModifier: 1.0 },
                    scraps: { name: "Scraps", charges: 8, speedModifier: 1.0 },
                    wire_spool: { name: "Wire Spool", charges: 12, speedModifier: 1.0 },
                    clean_rag: { name: "Clean Rag", charges: 0, speedModifier: 1.2 },
                    socket_swivels: { name: "Socket Swivels", charges: 0, speedModifier: 1.3 },
                    brand_new_part: { name: "Brand New Part", charges: 0, speedModifier: 1.0, flatProgress: 10 }
                }
            };

            const survivorsContainer = document.getElementById('survivors-container');
            const calculateBtn = document.getElementById('calculate');
            const breakdownContainer = document.getElementById('calculation-breakdown');

            const populateSelect = (select, data, type) => {
                select.innerHTML = '';
                for (const key in data) {
                    const item = data[key];
                    const option = document.createElement('option');
                    option.value = key;
                    let text = `${item.name}`;
                    if (type === 'toolbox' && item.charges > 0) {
                        text += ` (${item.charges}c, +${((item.speedModifier - 1) * 100).toFixed(0)}%)`;
                    } else if (type === 'addon' && key !== 'none') {
                        let parts = [];
                        if (item.charges !== 0) parts.push(`${item.charges > 0 ? '+' : ''}${item.charges}c`);
                        if (item.speedModifier > 1.0) parts.push(`+${((item.speedModifier - 1) * 100).toFixed(0)}%`);
                        if (key === 'brand_new_part') parts.push('+10 charges');
                        if (parts.length > 0) text += ` (${parts.join(', ')})`;
                    }
                    option.textContent = text;
                    select.appendChild(option);
                }
            };
            
            const createSurvivorCard = (index) => {
                const isFirst = index === 0;
                const card = document.createElement('div');
                card.id = `survivor-card-${index + 1}`;
                card.className = 'survivor-card bg-gray-700/50 p-4 rounded-lg space-y-3 shadow-md';
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="survivor-title text-xl font-bold tracking-wider">Survivor ${index + 1}</h3>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm font-medium text-gray-400">On Generator?</label>
                            <input type="checkbox" class="on-generator-checkbox h-4 w-4 rounded dbd-input text-red-600 focus:ring-red-500 border-gray-600" checked>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Toolbox</label><select class="toolbox-select dbd-input w-full p-2 rounded-md"></select></div>
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Add-on 1</label><select class="addon1-select dbd-input w-full p-2 rounded-md"></select></div>
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Add-on 2</label><select class="addon2-select dbd-input w-full p-2 rounded-md"></select></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 pt-2">
                        <div class="flex items-center space-x-2">
                            ${isFirst ? `
                            <input type="checkbox" class="prove-thyself-checkbox h-4 w-4 rounded dbd-input text-red-600 focus:ring-red-500 border-gray-600">
                            <label class="text-sm font-medium text-gray-400">Prove Thyself</label>` : ''}
                        </div>
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-gray-400 whitespace-nowrap">Perk Bonus %</label>
                            <input type="number" value="0" min="0" class="perk-bonus-input dbd-input w-full p-1 rounded-md text-center" placeholder="e.g. 9">
                        </div>
                    </div>
                `;
                survivorsContainer.appendChild(card);
                return card;
            };

            const initializeSurvivorCards = () => {
                for(let i = 0; i < 4; i++) {
                    const card = createSurvivorCard(i);
                    const toolboxSelect = card.querySelector('.toolbox-select');
                    const addon1Select = card.querySelector('.addon1-select');
                    const addon2Select = card.querySelector('.addon2-select');
                    
                    populateSelect(toolboxSelect, dbdData.toolboxes, 'toolbox');
                    populateSelect(addon1Select, dbdData.addons, 'addon');
                    populateSelect(addon2Select, dbdData.addons, 'addon');

                    toolboxSelect.addEventListener('change', () => {
                        const noToolbox = toolboxSelect.value === 'none';
                        addon1Select.disabled = noToolbox;
                        addon2Select.disabled = noToolbox;
                        if (noToolbox) {
                            addon1Select.value = 'none';
                            addon2Select.value = 'none';
                            addon1Select.dispatchEvent(new Event('change'));
                            addon2Select.dispatchEvent(new Event('change'));
                        }
                    });

                    addon1Select.addEventListener('change', () => {
                        const selectedValue = addon1Select.value;
                        Array.from(addon2Select.options).forEach(opt => opt.disabled = false);
                        if (selectedValue !== 'none') {
                            const optionInAddon2 = addon2Select.querySelector(`option[value="${selectedValue}"]`);
                            if (optionInAddon2) optionInAddon2.disabled = true;
                        }
                        if (addon2Select.value === selectedValue) {
                            addon2Select.value = 'none';
                            addon2Select.dispatchEvent(new Event('change'));
                        }
                    });

                    addon2Select.addEventListener('change', () => {
                        const selectedValue = addon2Select.value;
                        Array.from(addon1Select.options).forEach(opt => opt.disabled = false);
                        if (selectedValue !== 'none') {
                           const optionInAddon1 = addon1Select.querySelector(`option[value="${selectedValue}"]`);
                           if (optionInAddon1) optionInAddon1.disabled = true;
                        }
                         if (addon1Select.value === selectedValue) {
                            addon1Select.value = 'none';
                            addon1Select.dispatchEvent(new Event('change'));
                        }
                    });
                    
                    toolboxSelect.dispatchEvent(new Event('change'));
                }
            };
            
            const calculateTime = () => {
                const genTotalCharges = parseFloat(document.getElementById('generator-charges').value) || 90;

                const allSurvivorDivs = document.querySelectorAll('.survivor-card');
                const activeSurvivorDivs = Array.from(allSurvivorDivs).filter(div => div.querySelector('.on-generator-checkbox').checked);

                const numSurvivors = activeSurvivorDivs.length;
                if (numSurvivors === 0) {
                    const resultContainer = document.getElementById('result-container');
                    document.getElementById('result').textContent = '0.00 seconds';
                    resultContainer.classList.remove('hidden');
                    resultContainer.classList.add('fade-in-up');
                    breakdownContainer.innerHTML = `<p class="text-gray-500 text-center">No survivors on the generator.</p>`;
                    return;
                }
            
                let genChargesRemaining = genTotalCharges;
                let bnpCount = 0;

                activeSurvivorDivs.forEach(div => {
                    const addon1Key = div.querySelector('.addon1-select').value;
                    const addon2Key = div.querySelector('.addon2-select').value;
                    
                    if (addon1Key === 'brand_new_part' || addon2Key === 'brand_new_part') {
                        const bnpData = dbdData.addons.brand_new_part;
                        genChargesRemaining -= bnpData.flatProgress;
                        bnpCount++;
                    }
                });
                if (genChargesRemaining < 0) genChargesRemaining = 0;

                const coopPenalty = (numSurvivors - 1) * 15;
                const coopFactor = 1.0 - (coopPenalty / 100);
            
                const survivor1Card = document.getElementById('survivor-card-1');
                const proveThyselfActive = survivor1Card.querySelector('.prove-thyself-checkbox')?.checked && survivor1Card.querySelector('.on-generator-checkbox').checked;

                let survivors = [];
                let breakdownInfo = [];

                activeSurvivorDivs.forEach((div, i) => {
                    const individualPerkBonus = parseFloat(div.querySelector('.perk-bonus-input').value) || 0;
                    
                    let proveBonus = 0;
                    if (proveThyselfActive && div.id !== 'survivor-card-1') {
                        proveBonus = 10;
                    }

                    const toolboxKey = div.querySelector('.toolbox-select').value;
                    const addon1Key = div.querySelector('.addon1-select').value;
                    const addon2Key = div.querySelector('.addon2-select').value;
            
                    const toolbox = dbdData.toolboxes[toolboxKey];
                    const addon1 = dbdData.addons[addon1Key];
                    const addon2 = dbdData.addons[addon2Key];
            
                    const totalCharges = toolbox.charges + (addon1.charges || 0) + (addon2.charges || 0);
                    const itemSpeedModifier = toolbox.speedModifier + (addon1.speedModifier - 1) + (addon2.speedModifier - 1);
                    const totalPerkBonus = individualPerkBonus + proveBonus;
                    const baseSpeedWithPerks = 1 * (1 + totalPerkBonus / 100);
            
                    let speedWithItem;
                    const speedWithoutItem = baseSpeedWithPerks * coopFactor;
                    let timeToDeplete = Infinity;
            
                    const potentialSpeed = baseSpeedWithPerks * itemSpeedModifier;
            
                    if (toolboxKey !== 'none' && totalCharges > 0) {
                        speedWithItem = potentialSpeed * coopFactor;
                        const consumptionRate = speedWithItem;
                        if (consumptionRate > 0) {
                             timeToDeplete = totalCharges / consumptionRate;
                        }
                    } else {
                        speedWithItem = speedWithoutItem;
                    }

                    breakdownInfo.push({
                        name: div.querySelector('.survivor-title').textContent,
                        item: toolbox.name,
                        hasItem: toolboxKey !== 'none' && totalCharges > 0,
                        potentialSpeed: potentialSpeed,
                        finalSpeedWithItem: speedWithItem,
                        finalSpeedWithoutItem: speedWithoutItem,
                        timeToDeplete: timeToDeplete,
                        initialCharges: totalCharges
                    });
            
                    survivors.push({
                        id: i,
                        speedWithItem,
                        speedWithoutItem,
                        timeToDeplete,
                        itemDepleted: false,
                        chargesUsed: 0
                    });
                });
            
                let repairTime = 0;
                let chargesDone = 0;
            
                while (chargesDone < genChargesRemaining) {
                    let currentTotalSpeed = survivors.reduce((acc, s) => acc + (s.itemDepleted ? s.speedWithoutItem : s.speedWithItem), 0);
            
                    if (currentTotalSpeed <= 0) {
                        repairTime = Infinity;
                        break;
                    }
            
                    let nextEventTime = Infinity;
                    survivors.forEach(s => {
                        if (!s.itemDepleted && s.timeToDeplete < nextEventTime) {
                            nextEventTime = s.timeToDeplete;
                        }
                    });
            
                    const remainingCharges = genChargesRemaining - chargesDone;
                    const timeToFinish = remainingCharges / currentTotalSpeed;
            
                    const timeElapsedThisStep = Math.min(timeToFinish, nextEventTime);

                    survivors.forEach(s => {
                        if (!s.itemDepleted) {
                            s.chargesUsed += timeElapsedThisStep * s.speedWithItem;
                        }
                    });

                    if (timeToFinish <= nextEventTime) {
                        repairTime += timeToFinish;
                        break;
                    } else {
                        repairTime += nextEventTime;
                        chargesDone += currentTotalSpeed * nextEventTime;
            
                        survivors.forEach(s => {
                            if (!s.itemDepleted) {
                                s.timeToDeplete -= nextEventTime;
                                if (s.timeToDeplete <= 1e-9) { // Epsilon for float comparison
                                    s.itemDepleted = true;
                                }
                            }
                        });
                    }
                }
                
                const totalTime = repairTime;

                survivors.forEach((s, index) => {
                    const info = breakdownInfo[index];
                    info.chargesRemaining = Math.max(0, info.initialCharges - s.chargesUsed);
                });

                const resultEl = document.getElementById('result');
                const resultContainer = document.getElementById('result-container');
                resultContainer.classList.remove('hidden');
                resultContainer.classList.add('fade-in-up');
                
                if (totalTime === Infinity) {
                    resultEl.textContent = 'Error: Speed is zero.';
                } else {
                    resultEl.textContent = `${totalTime.toFixed(2)} seconds`;
                }

                const initialTotalSpeed = breakdownInfo.reduce((acc, b) => acc + b.finalSpeedWithItem, 0);
                const remainingChargesHtml = breakdownInfo.filter(b => b.hasItem).map(b => `
                    <div class="flex justify-between">
                        <span>${b.name}:</span>
                        <span class="font-mono text-white">${b.chargesRemaining.toFixed(1)} / ${b.initialCharges.toFixed(1)} c</span>
                    </div>
                `).join('');

                breakdownContainer.innerHTML = `
                    <div class="bg-gray-900/50 p-3 rounded-md border border-gray-700">
                        <p><span class="font-bold">Active Survivors:</span> ${numSurvivors}</p>
                        <p><span class="font-bold">Co-op Penalty:</span> <span class="dbd-red">-${coopPenalty}%</span> (x${coopFactor.toFixed(2)} total speed)</p>
                    </div>
                    ${bnpCount > 0 ? `
                    <div class="bg-gray-900/50 p-3 rounded-md border border-gray-700">
                        <p class="font-bold">Brand New Part(s) Used: ${bnpCount}</p>
                        <p>Instant Progress: <span class="text-white">${(bnpCount * 10).toFixed(1)} charges</span></p>
                        <p>Charges Left to Repair: <span class="text-white">${genChargesRemaining.toFixed(1)}</span></p>
                    </div>` : ''}
                    <div class="space-y-3 pt-2">
                        ${breakdownInfo.map(b => `
                            <div class="bg-gray-900/50 p-3 rounded-md text-sm border border-gray-700">
                                <p class="font-bold text-base">${b.name} (${b.item})</p>
                                <p class="text-gray-400">Potential Speed: <span class="font-mono" title="Speed from perks and items before co-op penalty">${b.potentialSpeed.toFixed(2)} c/s</span></p>
                                ${b.hasItem ? `
                                    <p>&#x21B3; Actual Speed (w/ Item): <span class="text-white font-mono">${b.finalSpeedWithItem.toFixed(2)} c/s</span> for ${b.timeToDeplete.toFixed(2)}s</p>
                                    <p>&#x21B3; Actual Speed (no Item): <span class="text-gray-400 font-mono">${b.finalSpeedWithoutItem.toFixed(2)} c/s</span></p>
                                ` : `
                                    <p>&#x21B3; Actual Speed: <span class="text-white font-mono">${b.finalSpeedWithItem.toFixed(2)} c/s</span></p>
                                `}
                            </div>
                        `).join('')}
                    </div>
                    <div class="bg-gray-900/50 p-3 rounded-md mt-2 text-center border border-gray-700">
                        <p class="font-bold">Initial Combined Speed</p>
                        <p class="text-2xl font-mono text-white">${initialTotalSpeed.toFixed(2)} c/s</p>
                        <p class="text-xs text-gray-400 mt-1">${genChargesRemaining.toFixed(1)} charges / ${initialTotalSpeed.toFixed(2)} c/s = ~${(genChargesRemaining / initialTotalSpeed).toFixed(2)}s repair time</p>
                    </div>
                    ${remainingChargesHtml ? `
                    <div class="bg-gray-900/50 p-3 rounded-md mt-4 border border-gray-700">
                        <p class="font-bold text-center text-lg">Remaining Toolbox Charges</p>
                        <div class="space-y-1 mt-2 text-sm">
                            ${remainingChargesHtml}
                        </div>
                    </div>
                    ` : ''}
                `;
            };

            calculateBtn.addEventListener('click', calculateTime);

            initializeSurvivorCards();
        });
    </script>

</body>
</html>


